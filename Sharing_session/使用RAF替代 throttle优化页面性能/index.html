<!DOCTYPE html>
  <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>RAFçš„æ›¿ä»£throttle</title>
    </head>
    <body>
        <div style="height: 1000px"></div>
    </body>
  </html>
<script>
function throttle(func, delay, deadline) { // ğŸŠä¼˜åŒ–2å
    // ğŸ¤”ä¸ºå•¥å¯ä»¥ä¿å­˜å˜é‡last
    let last; // ğŸŠ ä¼˜åŒ–2å let last = new Date().getTime();
    let timeId; // ğŸŠ ä¼˜åŒ–1å
    return function(args) {
        let self = this;
        let now = new Date().getTime();
        clearTimeout(timeId); // ğŸŠä¼˜åŒ–1å
        if (last && now < last + deadline) { // ğŸŒ¹ ä¼˜åŒ–2 now - last < deadline;
            // clearTimeout(timeId); // ğŸŒ¹ä¼˜åŒ–1
            timeId = setTimeout(() => {
                last = now;
                func.apply(self, arguments);
            }, delay);
        } else {
            last = now;
            func.apply(self, arguments);
        }
    };
}
// å®é™…æƒ³ç»‘å®šåœ¨ scroll äº‹ä»¶ä¸Šçš„ handler
function realFunc(){
    console.log("Success");
}
window.addEventListener('scroll',throttle(realFunc,500,1000));
// function throttle(func, wait, mustRun) {
//     var timeout,
//         startTime = new Date();
//         console.log('startTime', startTime);
//     return function() {
//         var context = this,
//             args = arguments,
//             curTime = new Date();
//         console.log('curTime', curTime);

//         clearTimeout(timeout);
//         // å¦‚æœè¾¾åˆ°äº†è§„å®šçš„è§¦å‘æ—¶é—´é—´éš”ï¼Œè§¦å‘ handler
//         if(curTime - startTime >= mustRun){
//             func.apply(context,args);
//             console.log('-----startTime = curTime', startTime, curTime);
//             startTime = curTime;
//         // æ²¡è¾¾åˆ°è§¦å‘é—´éš”ï¼Œé‡æ–°è®¾å®šå®šæ—¶å™¨
//         }else{
//             timeout = setTimeout(func, wait);
//         }
//     };
// };
// // å®é™…æƒ³ç»‘å®šåœ¨ scroll äº‹ä»¶ä¸Šçš„ handler
// function realFunc(){
//     console.log("Success");
// }
// window.addEventListener('scroll',throttle(realFunc,10,16.7));


// -------------------------------
// var ticking = false; // rAF è§¦å‘é”
 
// function onScroll(){
//   if(!ticking) {
//     requestAnimationFrame(realFunc);
//     ticking = true;
//   }
// }
 
// function realFunc(){
//     // do something...
//     console.log("Success");
//     ticking = false;
// }
// // æ»šåŠ¨äº‹ä»¶ç›‘å¬
// window.addEventListener('scroll', onScroll, false);
</script>